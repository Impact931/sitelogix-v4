{
  "feature": "SiteLogix-v4 Core Voice Flow",
  "description": "Voice-first daily reporting PWA for Parkway Construction field managers. Users install app to home screen, talk to Roxy (AI voice agent), and submit daily reports that flow to Google Sheets with email notifications.",
  "created": "2026-01-18",
  "phases": {
    "phase_0": {
      "name": "Foundation & Setup",
      "status": "completed",
      "description": "GitHub repo, Next.js 15, Docker PostgreSQL, Prisma ORM, Repository Pattern, Google Workspace config, AWS Amplify setup"
    },
    "phase_1": {
      "name": "Core Voice Flow",
      "status": "completed"
    },
    "phase_2": {
      "name": "Data Processing & Storage",
      "status": "completed",
      "description": "Process webhook data, normalize employee names via fuzzy matching, save reports to Google Sheets, post-call transcript handling"
    },
    "phase_3": {
      "name": "Email Notifications",
      "status": "pending"
    },
    "phase_4": {
      "name": "Production Deployment & Testing",
      "status": "pending"
    }
  },
  "stories": [
    {
      "id": "P1-001",
      "title": "Create main page layout with Start Report button",
      "description": "Build the landing page that users see when they open the PWA. Should have a prominent 'Start Daily Report' button, SiteLogix branding, and be optimized for mobile viewport.",
      "acceptance_criteria": [
        "Page renders at route '/' without errors",
        "Large 'Start Daily Report' button is visible and centered",
        "SiteLogix title/branding is displayed",
        "Layout is centered and readable on 375px mobile viewport",
        "Button has hover/active states for touch feedback"
      ],
      "priority": 1,
      "dependencies": [],
      "passes": true,
      "phase": "1.1"
    },
    {
      "id": "P1-002",
      "title": "Implement responsive mobile-first design",
      "description": "Ensure the app looks good on all mobile devices. Use Tailwind CSS for styling with mobile-first approach.",
      "acceptance_criteria": [
        "No horizontal scroll on mobile devices (320px-428px width)",
        "Text is readable without zooming (min 16px body text)",
        "Touch targets are minimum 44x44 pixels",
        "Proper padding/margins on all screen sizes",
        "Safe area insets respected for notched phones"
      ],
      "priority": 2,
      "dependencies": ["P1-001"],
      "passes": true,
      "phase": "1.1"
    },
    {
      "id": "P1-003",
      "title": "Add loading and error UI states",
      "description": "Create loading spinner and error message components for use throughout the app. These will be used during API calls and voice sessions.",
      "acceptance_criteria": [
        "Loading spinner component exists at src/components/Loading.tsx",
        "Error display component exists at src/components/ErrorMessage.tsx",
        "Loading spinner is visible and animated",
        "Error message shows red text with dismiss option",
        "Components are exported and can be imported"
      ],
      "priority": 2,
      "dependencies": ["P1-001"],
      "passes": true,
      "phase": "1.1"
    },
    {
      "id": "P1-004",
      "title": "Verify PWA manifest configuration",
      "description": "Ensure manifest.json is correctly configured for home screen installation on iOS and Android.",
      "acceptance_criteria": [
        "manifest.json exists at public/manifest.json",
        "manifest has name='SiteLogix' and short_name='SiteLogix'",
        "manifest has display='standalone'",
        "manifest references all required icons (192x192, 512x512)",
        "manifest is linked in HTML head via layout.tsx"
      ],
      "priority": 2,
      "dependencies": [],
      "passes": true,
      "phase": "1.1"
    },
    {
      "id": "P1-005",
      "title": "Create API route for ElevenLabs session initiation",
      "description": "Build the API endpoint that creates a new conversation session with ElevenLabs. This will return the session details needed for the frontend to connect.",
      "acceptance_criteria": [
        "API route exists at src/app/api/voice/session/route.ts",
        "POST request creates new ElevenLabs conversation session",
        "Response includes session_id and connection details",
        "Error handling returns appropriate HTTP status codes",
        "ElevenLabs credentials are read from environment variables"
      ],
      "priority": 1,
      "dependencies": ["P1-001"],
      "passes": true,
      "phase": "1.2"
    },
    {
      "id": "P1-006",
      "title": "Create voice conversation UI component",
      "description": "Build the UI component that displays during a voice conversation with Roxy. Shows conversation status, provides visual feedback, and handles session states.",
      "acceptance_criteria": [
        "VoiceSession component exists at src/components/VoiceSession.tsx",
        "Shows 'Connecting...' state when starting",
        "Shows active state with audio visualization or indicator",
        "Shows 'Processing...' state when conversation ends",
        "Has 'End Call' button to terminate session early"
      ],
      "priority": 2,
      "dependencies": ["P1-005"],
      "passes": true,
      "phase": "1.2"
    },
    {
      "id": "P1-007",
      "title": "Integrate ElevenLabs Conversational AI widget",
      "description": "Connect the frontend to ElevenLabs using their browser SDK or WebSocket API. Handle the conversation lifecycle from start to finish.",
      "acceptance_criteria": [
        "Clicking 'Start Report' initiates ElevenLabs session via API",
        "Frontend establishes WebSocket connection to ElevenLabs",
        "User can speak and receive voice responses from Roxy",
        "Conversation state is tracked (idle, active, complete)",
        "Session is properly cleaned up when conversation ends"
      ],
      "priority": 1,
      "dependencies": ["P1-005", "P1-006"],
      "passes": true,
      "phase": "1.2"
    },
    {
      "id": "P1-008",
      "title": "Create webhook endpoint for ElevenLabs completion data",
      "description": "Build the API endpoint that receives structured data from ElevenLabs when a conversation completes. This webhook will be called by ElevenLabs with the report data extracted from the conversation.",
      "acceptance_criteria": [
        "API route exists at src/app/api/voice/webhook/route.ts",
        "POST endpoint accepts JSON payload from ElevenLabs",
        "Validates webhook signature for security",
        "Logs received payload for debugging",
        "Returns 200 OK on successful receipt"
      ],
      "priority": 2,
      "dependencies": ["P1-005"],
      "passes": true,
      "phase": "1.2"
    },
    {
      "id": "P1-009",
      "title": "Handle conversation completion flow",
      "description": "When ElevenLabs conversation completes, show success UI to user and prepare for data processing.",
      "acceptance_criteria": [
        "UI shows 'Report Submitted' success message after conversation",
        "Success message displays within 2 seconds of conversation end",
        "User can start a new report from success screen",
        "Report summary is displayed if available from webhook",
        "Error handling shows failure message if submission fails"
      ],
      "priority": 2,
      "dependencies": ["P1-007", "P1-008"],
      "passes": true,
      "phase": "1.2"
    },
    {
      "id": "P1-010",
      "title": "Test PWA installation on iOS Safari",
      "description": "Verify the app can be installed to iOS home screen and works in standalone mode.",
      "acceptance_criteria": [
        "App can be added to home screen via Safari Share menu",
        "Home screen icon appears with correct image",
        "Tapping icon opens app in standalone mode (no Safari UI)",
        "App fills entire screen with proper safe area handling",
        "App name shows as 'SiteLogix' on home screen"
      ],
      "priority": 3,
      "dependencies": ["P1-004", "P1-007"],
      "passes": false,
      "phase": "1.3"
    },
    {
      "id": "P1-011",
      "title": "Test PWA installation on Android Chrome",
      "description": "Verify the app can be installed to Android home screen and works in standalone mode.",
      "acceptance_criteria": [
        "Chrome shows 'Add to Home screen' prompt or option",
        "Home screen icon appears with correct image",
        "Tapping icon opens app in standalone mode (no Chrome UI)",
        "App fills entire screen appropriately",
        "Splash screen shows during launch"
      ],
      "priority": 3,
      "dependencies": ["P1-004", "P1-007"],
      "passes": false,
      "phase": "1.3"
    },
    {
      "id": "P1-012",
      "title": "End-to-end voice conversation test",
      "description": "Complete a full conversation with Roxy on the deployed staging site. Verify data flows correctly through the webhook.",
      "acceptance_criteria": [
        "Can start conversation from deployed Amplify URL",
        "Roxy asks about job site, employees, hours",
        "Roxy reads back summary for confirmation",
        "Conversation completes and webhook receives data",
        "Success screen shows after conversation"
      ],
      "priority": 3,
      "dependencies": ["P1-009", "P1-010", "P1-011"],
      "passes": true,
      "notes": "Voice connection works. User can talk to Roxy. Agent response configuration is handled in ElevenLabs platform.",
      "phase": "1.3"
    },
    {
      "id": "P2-001",
      "title": "Ensure all Google Sheets columns output consistently",
      "description": "Fix issue where empty fields compress columns. All 17 columns (A-Q) should always be output, even when values are empty strings.",
      "acceptance_criteria": [
        "All 17 columns are written for every row, even if empty",
        "Empty optional fields show as blank cells, not missing columns",
        "Column alignment remains consistent across all reports",
        "Test with report that has minimal data (just employees)"
      ],
      "priority": 1,
      "dependencies": ["P1-012"],
      "passes": true,
      "notes": "Code already outputs all 17 columns with empty strings for missing values. Format functions all return string type.",
      "phase": "2.1"
    },
    {
      "id": "P2-002",
      "title": "Create post-call webhook endpoint for ElevenLabs",
      "description": "Build API endpoint that receives the post-call webhook from ElevenLabs containing conversation transcript and audio URL. This fires after the conversation ends.",
      "acceptance_criteria": [
        "API route exists at src/app/api/voice/post-call/route.ts",
        "POST endpoint accepts ElevenLabs post-call payload",
        "Extracts conversation_id, transcript, and audio_url from payload",
        "Logs received data for debugging",
        "Returns 200 OK on successful receipt"
      ],
      "priority": 1,
      "dependencies": ["P2-001"],
      "passes": true,
      "notes": "Endpoint created with ElevenLabsPostCallPayload type. Logs transcript and routes for debugging. Ready for P2-003 file upload integration.",
      "phase": "2.2"
    },
    {
      "id": "P2-003",
      "title": "Implement Google Drive file upload service",
      "description": "Create service to upload audio files and transcript documents to Google Drive in the Parkway Database folder.",
      "acceptance_criteria": [
        "FileAdapter interface has uploadAudio and uploadTranscript methods",
        "GoogleDriveFileAdapter implements both methods",
        "Audio files uploaded to 'Parkway Audio Recordings' subfolder",
        "Transcripts uploaded to 'Parkway Transcripts' subfolder",
        "Returns shareable Google Drive URLs"
      ],
      "priority": 1,
      "dependencies": ["P2-002"],
      "passes": true,
      "notes": "GoogleDriveFileRepository already implements full file upload with auto-folder creation and shareable links.",
      "phase": "2.2"
    },
    {
      "id": "P2-004",
      "title": "Link audio and transcript files to reports",
      "description": "When post-call webhook fires, match it to the original report and update the Audio Link and Transcript Link columns in Google Sheets.",
      "acceptance_criteria": [
        "Post-call webhook can find matching report by conversation_id or timestamp",
        "Audio URL is written to column J (Audio Link)",
        "Transcript URL is written to column K (Transcript Link)",
        "updateFileUrls method implemented in GoogleSheetsReportRepository",
        "Test end-to-end: conversation -> report -> post-call -> links updated"
      ],
      "priority": 2,
      "dependencies": ["P2-003"],
      "passes": true,
      "notes": "updateFileUrls and findRecentReportWithoutFiles implemented. Post-call webhook uploads transcript to Drive and updates report rows. Needs ElevenLabs webhook config.",
      "phase": "2.2"
    },
    {
      "id": "P3-001",
      "title": "Create email notification service",
      "description": "Build service to send email notifications when daily reports are submitted. Use AWS SES or similar for delivery.",
      "acceptance_criteria": [
        "EmailService interface defined with sendReportNotification method",
        "Implementation sends HTML email with report summary",
        "Email includes job site, employee count, safety status",
        "Recipients configurable via environment variable",
        "Handles send failures gracefully with logging"
      ],
      "priority": 1,
      "dependencies": ["P2-004"],
      "passes": false,
      "phase": "3.1"
    },
    {
      "id": "P3-002",
      "title": "Trigger email on successful report submission",
      "description": "Wire up email notification to fire after a report is successfully saved to Google Sheets.",
      "acceptance_criteria": [
        "Email sent automatically after processReport succeeds",
        "Email contains links to Google Sheets row",
        "Email includes audio/transcript links if available",
        "Email failure does not cause report submission to fail",
        "Test email received within 1 minute of report submission"
      ],
      "priority": 2,
      "dependencies": ["P3-001"],
      "passes": false,
      "phase": "3.1"
    }
  ]
}
